<?xml version="1.0" encoding="utf-8"?>
<!-- 
  Telenor Player
-->
<mx:Application 
	xmlns:mx="http://www.adobe.com/2006/mxml" 
	xmlns:com="com.*" 
	xmlns:visual="com.visual.*"
	layout="absolute" 
	verticalScrollPolicy="off" 
	horizontalScrollPolicy="off"
	usePreloader="false" 
	backgroundAlpha="0"
	width="100%" 
	height="100%" 
	creationComplete="init(); resizeTray();" 
	resize="resizeTray();" 
	>
	<mx:Style>
     Application {
     	fontFamily: Telenor,Helvetica,Arial;
     }
	</mx:Style>
 	<mx:Script source="Utility.as"></mx:Script>
 	<mx:Script source="Fullscreen.as"></mx:Script>
 	<mx:Script source="Identity.as"></mx:Script>
 	<mx:Script source="AppProperties.as"></mx:Script>
 	<mx:Script source="ActiveElement.as"></mx:Script>
 	<mx:Script source="doJSON.as"></mx:Script>
	<mx:Script>
		<![CDATA[
			import com.PlayList;
			import com.PlayListEvent;
			import com.PlayerButton;
			import com.SmoothImage;
			import com.adobe.serialization.json.JSONParseError;
			import com.philemonworks.flex.util.HashCollection;
			import com.visual.VisualOmniture;
			public var omniture:VisualOmniture = null;
			
			import flash.display.StageDisplayState;
			import flash.external.ExternalInterface;
			import flash.utils.setInterval;
			import flash.utils.setTimeout;
			
			// Default domain (used when testing from localhost)
			private var defaultDomain:String = 'telenor.23video.com';
			// Default photo_id (used to if you want a specific photo/video to be shown, otherwise empty)
			private var defaultPhotoId:String = '';
			private var defaultAlbumId:String = '';
			private var playerId:String = '0';

			private var context:Object = {};
			private var recommendations:Object = {};
			
			private var playList: PlayList;
			[Bindable] private var enablePlayList: Boolean = false;		
			[Bindable] private var showPlayList: Boolean = false;
			[Bindable] private var cleanVideoState:String = 'paused';
			[Bindable] private var applicationLoaded:Boolean = false;
			public var ads = null;
			public var forceHideTray:Boolean = false;
			
			public function init():void {
				prepareTimers();
				flash.system.Security.allowDomain('*');
				try {
					var objectID:String = new String(ExternalInterface.objectID);
					if (ExternalInterface.available && (objectID.length>0 && objectID!='null')) {
						ExternalInterface.addCallback('unloadVideoPlayer', function():void {unload();});
						ExternalInterface.addCallback('pauseVideo', function():void {pauseVideoElement();});
						ExternalInterface.addCallback('playVideo', function():void {playVideoElement();});
						ExternalInterface.addCallback('getPlayState', function():String {return(cleanVideoState);});
						ExternalInterface.addCallback('getPlayheadTime', function():Object {return(video.playheadTime + activeElement.getNumber('start'));});
						ExternalInterface.addCallback('setPlayheadTime', function(time:int):void {progress.seekVideoTo(time);});
						ExternalInterface.addCallback('getTotalTime', function():Object {return(video.totalTime);});
						ExternalInterface.addCallback('getCurrentPhotoID', function():Object {return(activeElement.get('photo_id'));});
						ExternalInterface.addCallback('getJSONSource', function():Object {return(props.get('jsonSource'));});
						ExternalInterface.addCallback('echo', function(x:Object):Object {return(x);});
					}
		        } catch (e:SecurityError) {} catch(e:Error) {}
				load();
			}
			public function unload():void {
				// This function is triggered via ExternalInterface and some JavaScript because Flex is useless.
				try {if(video.playing) video.pause();} catch(e:Error){}
				try {if(video.playing) reportPlay('end', video.playheadTime)} catch(e:Error){}
			}
			public function load():void {
				omniture = new VisualOmniture(this,video);
				
				// Are we using a specific player, or just the default? (if so, we want to specify the player id to get the correct video settings)
				var testCustomPlayer:Array = new RegExp('/([0-9]+)\.swf').exec(FlexGlobals.topLevelApplication.url);
				if (testCustomPlayer && testCustomPlayer.length>1) playerId = testCustomPlayer[1]; 
				
				// Mash up embed parameters, including .swf?..., Flashvars, width and height to get a good embed code   
				var a:Array = []; var v:String;
				for (v in FlexGlobals.topLevelApplication.parameters) {a.push(encodeURIComponent(v) + '=' + encodeURIComponent(FlexGlobals.topLevelApplication.parameters[v]));}
				a.push('width=' + encodeURIComponent(FlexGlobals.topLevelApplication.width));
				a.push('height=' + encodeURIComponent(FlexGlobals.topLevelApplication.height));
				
				// Get settings for this player from 23 Video
				initLoadURL();
				doAPI('/api/player/settings', {player_id:(playerId?playerId:''), parameters:a.join('&')}, function(o:Object):void{
					initProperties(o.settings);
					// Load content
					initActiveElement();
					doJSON((props.get('jsonSource') as String), function(o:Object):void{
						context=o; 
						build();
					});
				});
			}
			public function build():void {
				if(!prioritizeLiveStreams && context && context.photos && context.photos.length>0) setActiveElement(0, false, props.getNumber('start'));
				
				if (props.get('showTray')) tray.visible=true;
				bigPlayImage.imageContainer.horizontalCenter = 5;
				resizeTray();

 				if (props.get('showTray') && props.get('showBrowse')) {
					// Generate the recommendation playlist
					var recommendationSource:String = getRecommendationSource();
					if(recommendationSource==props.get('jsonSource')) {
						// The list displays all the items in the feed
						recommendations=context; createPlayList();
					} else {
						// The list consists of recommendations, we'll need to load them
						// Loading is deferred for a few seconds if browseMode isn't on 
						try {
							doJSON(recommendationSource, function(o:Object):void{recommendations=o; createPlayList();});
						} catch(e:JSONParseError) {enablePlayList = false; props.put('showShare', false);}
					}
				}
				clearQuestion();
				applicationLoaded = true;
			}
			
            private function createPlayList():void  {
				trace('createPlayList()');
            	var arr:Array = createItemsArray(recommendations);
            	if(arr.length<=1) return;
				enablePlayList = true;
				playListHolder.removeAllChildren(); // if we've done this before, clean up after ourselves.
            	playList = new PlayList();
            	playList.width = playListContainer.width;
            	playList.verticalScrollPolicy = "off";
				playList.itemArray = arr;
				playList.addEventListener(PlayListEvent.SELECT_ITEM, function(evt:PlayListEvent):void {
						// When clicking the recommendation playlist, we shift context -- it's no longer the initially selected video, but the playlist objects
						context = recommendations;
						if(evt.itemID>=0) {
							if(props.get('playlistClickMode')=='link') {
								if (context.photos.length>evt.itemID) {
									var o:Object = context.photos[evt.itemID];
									goToUrl(o.one);
								}
							} else {
            					playListHide();
            					setElementByID(evt.itemID, true);
							}
            			}
            		});
				playListHolder.addChild(playList);
				
				if(props.get('browseMode')) {
					showPlayList = true;
				}
            }
			private function playListShow():void {
				trace('playListShow(): showTray = ' + props.get('showTray'));
				trace('playListShow(): showBrowse = ' + props.get('showBrowse'));
				trace('playListShow(): enablePlayList = ' + enablePlayList);
				if (!props.get('showTray') || !props.get('showBrowse') || !enablePlayList) return;
				showPlayList = true;
            }
			private function playListHide():void {
				showPlayList = false;
            }
            private function prepareTimers():void {
				// PLAY EVENTS
				// Report plays back to analytics continously
				setInterval(function():void{
						try {
							if(video.playing) reportPlay('start', video.playheadTime);
						}catch(e:ErrorEvent){}
					}, 30000);
            }             
            private function onPlayListDone():void {
            	if(props.get('loop')) { 
            		load();
            	} else {
            		if (playList) {
            			playList.headline = new String(props.get('recommendationHeadline'));
            			playListShow();
            		}
            	}
            }
			private function onVideoStateChange(evt:Event):void {
				if(evt.currentTarget.state==VideoEvent.PLAYING || evt.currentTarget.state==VideoEvent.SEEKING) {
					if(ads) ads.overlay();
					cleanVideoState = 'playing';
					playListHide();
				} else if(evt.currentTarget.state==VideoEvent.LOADING || evt.currentTarget.state==VideoEvent.BUFFERING) {
					cleanVideoState = 'buffering';
					playListHide();
				} else if(evt.currentTarget.state==VideoEvent.DISCONNECTED || evt.currentTarget.state==VideoEvent.COMPLETE || evt.currentTarget.state==VideoEvent.PAUSED || evt.currentTarget.state==VideoEvent.STOPPED) {
					cleanVideoState = 'paused';
					if (identityVideo.visible==false) playListShow();
				}
				trace('cleanVideoState = ' + cleanVideoState);
                switch (evt.currentTarget.state) {
                	case VideoEvent.PAUSED:
						reportPlay('end', video.playheadTime);
						break;
                	case VideoEvent.PLAYING:
						image.visible = false;
						reportPlay('start', video.playheadTime);
                		break;
                    case VideoEvent.CONNECTION_ERROR:
                        displayError('Unable to connect to video');
                        break;
                }
                resizeTray();
            }
            private function onVideoComplete(ignoreIdentity:Boolean=false):void {
				reportPlay('end', video.playheadTime);
     			if(!ignoreIdentity) return(handleIdentity('after', function():void {onVideoComplete(true);}));
            	if(props.get('loop')) {
            		var more:Boolean = nextElement();
            		if(!more) onPlayListDone();
            	} else {
            		onPlayListDone();
            	}
            }
            private function onPlayListResize():void {
            	var c:Array = playListHolder.getChildren();
            	if (c.length) c[0].width = playListContainer.width;
            }
            private function resizeTray():void {
            	if(tray) {
            		var before:Boolean = tray.visible;
	            	tray.visible = false;
	            	
	            	// Tray
	            	tray.width = video.width-20;
	            	// Sharing
	            	embedPanel.width = tray.width;
	            	// Progress etc
	            	progressContainer.width = tray.width-61;

	            	tray.visible = before;
	            }
            }
			
			public var showQuestion:Boolean = true;
			public function answerQuestion(answer:String):void {
				omniture.trackEvent(answer);
				questionButtons.visible=false; 
				questionAnswer.visible=true;
			}
			
			public function clearQuestion():void {
				trace("clearQuestion(): evaluate_video = " + activeElement.getBoolean('evaluate_video'));
				trace("clearQuestion(): source = " + props.getBoolean('source'));
				if(activeElement.getBoolean('evaluate_video')) {
					questionButtons.visible=true; 
					questionAnswer.visible=false;
					questionFeedback.visible=true;
				} else {
					questionButtons.visible=false; 
					questionAnswer.visible=true;
					questionFeedback.visible=false;
				}
				if (props.getString('source') != 'site' && props.getString('source') != 'telenor' && props.getString('source') != 'admin') {
					questionLink.visible = true;
					showQuestion = true;
				} else {
					questionLink.visible = false;
					showQuestion = activeElement.getBoolean('evaluate_video');
				}
				trace("clearQuestion(): questionLink.visible = " + questionLink.visible);
				trace("clearQuestion(): showQuestion = " + showQuestion);
			}
		]]>
	</mx:Script>	
	
	<!-- Simple element to provide a backdrop when everything else fails -->
	<mx:Label id="errorContainer" 
		color="white"
		/>
	
	<mx:Canvas id="contentContainer"
		x="{props.getNumber('horizontalPadding')/2}"
		y="0"
		width="{FlexGlobals.topLevelApplication.width-props.getNumber('horizontalPadding')}"
		height="{FlexGlobals.topLevelApplication.height-props.getNumber('verticalPadding')}"
		verticalScrollPolicy="off"
		horizontalScrollPolicy="off"
		>
	<!-- Click Container when wmode='direct' -->
	<mx:Canvas 
		top="0" right="0" bottom="0" left="0"
		click="playListHide(); if(video.playing) pauseVideoElement(); else playVideoElement();"
		/>
	<!-- Image and Video -->
	<visual:VisualVideo id="video"
		volume="1" 
		horizontalCenter="0" 
		verticalCenter="0" 
		bufferTime="10"
		width="100%"
		height="100%"
		click="playListHide(); if(video.playing) pauseVideoElement(); else playVideoElement();" 
		stateChange="onVideoStateChange(event);"
		complete="onVideoComplete();"
		resize="resizeTray();"
		/>
	<com:SmoothImage id="image" 
		source="{activeElement.get('photoSource')}" 
		width="{(contentContainer.width/contentContainer.height>activeElement.get('aspectRatio') ? video.height*(activeElement.get('aspectRatio') as Number) : contentContainer.width)}"
		height="{(contentContainer.width/contentContainer.height>activeElement.get('aspectRatio') ? contentContainer.height : contentContainer.width/(activeElement.get('aspectRatio') as Number))}"
		horizontalCenter="0" 
		verticalCenter="0"
		click="{playListHide(); playVideoElement()}" 
		/>

 	 <!-- Big Play -->
	<com:PlayerButton id="bigPlayImage" 
		width="64" 
		height="60"
		backgroundColor="#1498E0" 
		backgroundAlpha="{(props.get('trayAlpha') as Number)}" 
		imageSource="@Embed(source='assets/buttons/play.swf')"
		imageWidth="34" 
		imageHeight="30"
		verticalCenter="0" 
		horizontalCenter="0" 
		visible="{(applicationLoaded &amp;&amp; (props.get('showBigPlay') as Boolean) &amp;&amp; cleanVideoState=='paused' &amp;&amp; !identityVideo.playing)}" 
		click="playVideoElement()"
		/>
 	
	<!-- Extra displays for identity video and photo -->
	<visual:VisualVideo id="identityVideo" 
		visible="false" 
		volume="1" 
		horizontalCenter="0" 
		verticalCenter="0" 
		bufferTime="2" 
		width="{video.width}" 
		height="{video.height}"
		buttonMode="true"
		enableStageVideo="false"
		playheadUpdate="{var secs:int=Math.round(identityVideo.totalTime-identityVideo.playheadTime); var mess:String = (secs!=1 ? props.getString('identityCountdownTextPlural') : props.getString('identityCountdownTextSingular')); identityMessage.message = mess.replace(/%/, secs);}"
		/>
	<com:SmoothImage id="identityPhoto" 
		visible="false" 
		horizontalCenter="0" 
		verticalCenter="0" 
		maxWidth="{contentContainer.width}" 
		maxHeight="{contentContainer.height}" 
		buttonMode="true"
		/>
	<com:OverlayMessage id="identityMessage"
		fontFamily="{props.get('trayFont')}" 
		color="{(styleManager.getColorName(props.get('trayTextColor')) as Number)}" 
		backgroundColor="#1498E0" 
		visible="{props.get('identityCountdown') &amp;&amp; identityVideo.visible}"
		allowClose="{props.get('identityAllowClose')}"
		close="{identityVideo.stop(); reportEvent(currentIdentityEvent=='after' ? 'postRollClose ' : 'preRollClose'); identityVideo.dispatchEvent(new Event('complete', true));}"
		/>
	<com:PlayerSubtitles id="subtitles"
		 width="{this.width}"
		 height="{this.height}"
		 x="0"
		 y="0"
		 targetVideo="{video}"
		 visible="{video.visible}"
		 design="{props.get('subtitlesDesign')}"
		 />

	<!-- Icon/Logo -->
	<mx:Box 
		id="logo" 
		visible="{(props.get('showLogo') as Boolean)}" 
		top="15" 
		right="15" 
		left="15" 
		bottom="15" 
		horizontalAlign="{props.get('logoAlign')}" 
		verticalAlign="{props.get('logoVAlign')}" 
		horizontalCenter="0" 
		verticalCenter="0"
		buttonMode="true"
		>
		<mx:Image 
			source="{props.get('logoSource')}" 
			alpha="{(props.get('logoAlpha') as Number)}" 
			maxWidth="{(props.get('logoWidth') as Number)}" 
			maxHeight="{(props.get('logoHeight') as Number)}" 
			horizontalAlign="{props.get('logoAlign')}" 
			verticalAlign="{props.get('logoVAlign')}"
			/> 
	</mx:Box>

	<mx:Canvas id="question" width="100%" height="100%" backgroundColor="black" verticalScrollPolicy="off" horizontalScrollPolicy="off" visible="{showPlayList &amp;&amp; showQuestion}" includeInLayout="{playListContainer.visible}">		
		<mx:Canvas id="questionButtons" width="100%" height="{question.height-tray.height}" verticalScrollPolicy="off" horizontalScrollPolicy="off">
			<mx:VBox verticalScrollPolicy="off" horizontalScrollPolicy="off" verticalCenter="0" horizontalCenter="0" horizontalAlign="center" verticalGap="15">
				<mx:Text text="Hjalp denne video dig?" color="white" fontSize="40" />
				<mx:HBox horizontalGap="15">
					<mx:Image source="@Embed(source='assets/buttons/telenor-yes.png')" buttonMode="true" click="answerQuestion('yes');" />
					<mx:Image source="@Embed(source='assets/buttons/telenor-no.png')" buttonMode="true" click="answerQuestion('no');"/>
				</mx:HBox>
			</mx:VBox>
		</mx:Canvas>
		<mx:Canvas id="questionAnswer" width="100%" height="{question.height-tray.height}" verticalScrollPolicy="off" horizontalScrollPolicy="off" visible="false">
			<mx:VBox verticalScrollPolicy="off" horizontalScrollPolicy="off" verticalCenter="0" horizontalCenter="0" horizontalAlign="center">
				<mx:Text id="questionFeedback" text="Tak for din feedback" color="white" fontSize="40" />
				<mx:HBox id="questionLink" buttonMode="true" click="goToUrl(activeElement.getString('player_link'));" useHandCursor="true">
					<mx:Text text="{activeElement.getString('player_link_text')}" fontSize="18" color="#149FEB" selectable="false" buttonMode="true" useHandCursor="true" />
				</mx:HBox>
			</mx:VBox>
		</mx:Canvas>	
	</mx:Canvas>
		
		
		
	</mx:Canvas>

	
	
	
	<!-- Tray -->
	<mx:VBox id="tray" 
		width="100%"
		horizontalScrollPolicy="off" 
		verticalScrollPolicy="off" 
		verticalGap="1"
		visible="false"
		bottom="0"
		left="0"
		right="0"
		>

		<!-- PlayList -->
		<mx:Canvas id="playListContainer"
			height="123" 
			width="100%" 
			backgroundColor="#1498E0"
			backgroundAlpha="{(props.get('trayAlpha') as Number)}" 
			visible="{showPlayList}"
			includeInLayout="{playListContainer.visible}"
			>
			<mx:Canvas id="playListHolder" 
				width="{tray.width}"
				verticalScrollPolicy="off" 
				horizontalScrollPolicy="off" 
				resize="onPlayListResize()"
				/>
		</mx:Canvas>					
		<!-- /PlayList -->

		<!-- Embed panel -->
		<mx:VBox 
			id="embedPanel" 
			width="100%" 
			horizontalGap="1" 
			height="68" 
			backgroundColor="#1498E0" 
			backgroundAlpha="{(props.get('trayAlpha') as Number)}" 
			paddingLeft="10" 
			paddingRight="10" 
			paddingTop="5" 
			verticalGap="3" 
			horizontalScrollPolicy="off" 
			verticalScrollPolicy="off" 
			visible="false"
			includeInLayout="{embedPanel.visible}"
			show="{reportEvent('shareEngaged');}"
			>
			<mx:Text 
				text="EMBED"
				color="{(styleManager.getColorName(props.get('trayTextColor')) as Number)}" 
				fontSize="{(props.get('trayTitleFontSize') as Number)}" 
				fontWeight="{props.get('trayTitleFontWeight')}" 
				/>
			<mx:TextArea 
				id="embedText" 
				height="21" 
				width="100%" 
				color="{(styleManager.getColorName(props.get('trayTextColor')) as Number)}" 
				backgroundColor="{(styleManager.getColorName(props.get('trayTextColor')) as Number)}" 
				backgroundAlpha="0.15" 
				text="{props.get('embedCode')}" 
				click="{reportEvent('embedEngaged'); embedText.setFocus(); embedText.selectionBeginIndex = 0; embedText.selectionEndIndex = embedText.text.length;}" 
				borderStyle="none" 
				paddingTop="2" 
				paddingLeft="2" 
				fontSize="11" /> 
		</mx:VBox>
		<!-- /Embed panel -->
	
		<mx:VBox 
			id="videoControls"
			verticalGap="0" hide="embedPanel.visible=false;"
			 horizontalScrollPolicy="off" verticalScrollPolicy="off">
			<mx:HBox
				horizontalGap="1" 
				horizontalScrollPolicy="off" 
				verticalScrollPolicy="off" 
				id="controlBox">
	    		<com:PlayerButton id="playImage"
	    			width="60" height="45" 
	    			imageSource="@Embed(source='assets/buttons/play.swf')"
	    			visible="{(cleanVideoState=='paused' &amp;&amp; !identityVideo.visible)}" 
	    			click="playVideoElement()"
					backgroundColor="#1498E0"  
					backgroundAlpha="{(props.get('trayAlpha') as Number)}" 
	    			/>
	    		<com:PlayerButton id="pauseImage" 
	    			width="60" height="45" 
	    			imageSource="@Embed(source='assets/buttons/pause.swf')"
	    			visible="{(cleanVideoState=='playing' &amp;&amp; !identityVideo.visible)}" 
	    			click="pauseVideoElement()"
					backgroundColor="#1498E0"  
					backgroundAlpha="{(props.get('trayAlpha') as Number)}" 
	    			/>
	    		<com:PlayerButton id="bufferImage"  
	    			width="60" height="45" 
	    			imageSource="@Embed(source='assets/buttons/buffering.swf')"
	    			visible="{(cleanVideoState=='buffering' &amp;&amp; !identityVideo.visible)}" 
					backgroundColor="#1498E0"  
					backgroundAlpha="{(props.get('trayAlpha') as Number)}" 
	    			/>  

				<mx:VBox 
					id="progressContainer"
					backgroundColor="#1498E0"
					backgroundAlpha="{(props.get('trayAlpha') as Number)}"
					verticalGap="1"
					paddingLeft="8"
					paddingRight="8"
					horizontalScrollPolicy="off" 
					verticalScrollPolicy="off" 
					width="{tray.width-61}"
					height="45"
					clipContent="false"
					>

					<mx:HBox 
						paddingTop="3"
						clipContent="false"
						height="24"
						width="100%"
						horizontalGap="0">
						<!-- Title -->
						<mx:Text 
							text="{activeElement.getString('title').toUpperCase()}"
							truncateToFit="true"
							fontSize="{(props.get('trayTitleFontSize') as Number)}" 
							fontWeight="{props.get('trayTitleFontWeight')}" 
							color="{(styleManager.getColorName(props.get('trayTextColor')) as Number)}" 
							paddingTop="2"
							visible="{video.width-featureButtons.width>100}"
							height="21"
							includeInLayout="true"
							width="{progressContainer.width-featureButtons.width-13}"
							/>

						<mx:HBox
							id="featureButtons"
							horizontalGap="0"
							paddingTop="2"
							>

							<!-- Live streams -->
							<com:PlayerButton id="liveStreamsBtn" 
								imageSource="@Embed(source='assets/buttons/live.swf')"
								visible="false"
								>
								<com:PlayerMenu 
									id="liveStreamsMenu"
									change="{setActiveElementToLiveStream(liveStreamsMenu.value, true)}"
									showOneItemMenus="true"
									backgroundColor="#1498E0" 
									backgroundAlpha="{(props.get('trayAlpha') as Number)}" 
									fontFamily="{props.get('trayFont')}" 
									color="{(styleManager.getColorName(props.get('trayTextColor')) as Number)}" 
									/>
							</com:PlayerButton>

							<!-- FeedPanel -->
				    		<com:PlayerButton id="feedpanelBtn" 
				    			imageSource="@Embed(source='assets/buttons/share.swf')"
				    			visible="{(props.get('showShare') as Boolean)}" 
				    			click="embedPanel.visible=props.get('showShare') &amp;&amp; !embedPanel.visible;"
				    			/>


							<!-- HDbutton-->
							<com:PlayerButton id="hdBtn" 
											  imageSource="@Embed(source='assets/buttons/hd.swf')"
											  >
								<com:PlayerMenu 
									id="formatsMenu"
									value="{currentVideoFormat}"
									change="{switchVideoFormat(new String(formatsMenu.value));}"
									backgroundColor="#1498E0" 
									backgroundAlpha="{(props.get('trayAlpha') as Number)}" 
									fontFamily="{props.get('trayFont')}" 
									color="{(styleManager.getColorName(props.get('trayTextColor')) as Number)}" 
									/>
							</com:PlayerButton>
							
							<!-- Subtitle button-->
							<com:PlayerButton id="subtitlesBtn" 
											  imageSource="@Embed(source='assets/buttons/cc.swf')"
											  >
								<com:PlayerMenu 
									id="subtitlesMenu"
									value="{subtitles.locale}"
									change="{subtitles.locale=new String(subtitlesMenu.value);}"
									backgroundColor="#1498E0" 
									backgroundAlpha="{(props.get('trayAlpha') as Number)}" 
									fontFamily="{props.get('trayFont')}" 
									color="{(styleManager.getColorName(props.get('trayTextColor')) as Number)}" 
									/>
							</com:PlayerButton>
							
							<!-- Mute and Unmute -->
							<com:PlayerButton id="muteImage"
											  imageSource="@Embed(source='assets/buttons/mute-on.swf')"
											  visible="{videoControls.visible &amp;&amp; video.volume>0}"
											  click="video.volume=0"
											  />
							<com:PlayerButton id="unmuteImage"
											  imageSource="@Embed(source='assets/buttons/mute-off.swf')"
											  visible="{videoControls.visible &amp;&amp; video.volume==0}"
											  click="video.volume=1"
											  />
							
							<!-- Twitter -->
							<com:PlayerButton id="twitterBtn" 
											  imageSource="@Embed(source='assets/buttons/twitter.swf')"
											  visible="{(props.get('showShare') as Boolean)}" 
											  click="{goToUrl(activeElement.get('link') + '/twitter?player_id=' + props.get('player_id'))}"
											  />
							<!-- Facebook -->
							<com:PlayerButton id="facebookBtn" 
											  imageSource="@Embed(source='assets/buttons/facebook.swf')"
											  visible="{(props.get('showShare') as Boolean)}" 
											  click="{goToUrl(activeElement.get('link') + '/facebook?player_id=' + props.get('player_id'))}"
											  />
							<!-- Fullscreen -->
							<com:PlayerButton id="fullscreenImage"
											  imageSource="@Embed(source='assets/buttons/fullscreen.swf')"
											  click="toggleFullScreen()"
											  />
						</mx:HBox> 
					</mx:HBox> 
					
					<!-- Progress bar -->
					<com:PlayerProgress id="progress"
										targetVideo="{video}"
										visible="{!activeElement.getBoolean('live') &amp;&amp; !identityVideo.visible}"
										width="100%" 
										height="21"
										/>
				</mx:VBox>
			</mx:HBox>
		</mx:VBox>	
	</mx:VBox>
		
		<!-- Text panel for post-roll html identity text -->
		<com:TextPanel id="identityPanel" 
					   backgroundColor="{(styleManager.getColorName(props.get('backgroundColor')) as Number)}"
					   >
			<mx:TextArea id="identityPanelText"
						 width="100%"
						 height="{(this.height-100)*0.9}" 
						 backgroundAlpha="0" 
						 borderStyle="none"
						 fontSize="12" 
						 editable="false" 
						 color="white"
						 paddingTop="10" 
						 paddingBottom="20"
						 click="{reportEvent('callToActionClick');}"
						 />
		</com:TextPanel> 
		<!-- / Text panel for post-roll -->
</mx:Application>
